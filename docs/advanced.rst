.. _advanced:

Advanced Usage and Publication Tools
====================================

esgadd_facetvalues
******************

This is a command-line utility that allows for the addition of supplemental faceted metadata beyond the values in the dataset_id and global attributes.  The command runs with similar options as esgpublish and is intended to run as a repeat of the --thredds catalog generation step.

Requirements
------------

A "dataset metadata" mapfile must be produced to call the utility.  The mapfile takes the form:

::

	<dataset_id> | <key>=<value> | ...

Where the <dataset_id>s are the same as those found in the mapfile produced by esgmapfile and used with esgpublish.  The subsequent columns store the key=value pairs for the supplementary facets.  Unlike the mapfile generated by esgmapfiles this one does not contain any references to the data files or file metadata.  For a corresponding publishing job, there should be one line corresponding to each dataset-specific mapfile generated by esgmapfile. 

.. note:: <value> (above) can contain spaces but not quotation marks, as they are not properly interprered by Solr for searches.

Usage
-----

::

	$ esgadd_facetvalues --project <project> --map <dataset_mapfile> --noscan --thredds --service fileservice

This step above will re-generate your thredds catalogs with the additional facets.  Finally, you will need to republish those catalogs to the Index Node / Solr.  For that you may use either your new or previously generated mapfiles, as long as they have the same list of dataset_ids.

::

	$ esgpublish --project <project> --map <dataset_mapfile> --noscan --publish

Note that if you have published "new" facets for the first time to the Index Node, they will not be searchable on Solr and moreover, will cause a an erroneous response.  The solution is to restart the Index Node right after publication and then attempt your search.


esgtest_publish
***************

The seemingly simple testing utility has some additional features not performed by default.

skip-unpublish
--------------

The ``--skip-unpublish`` or ``-x`` option should be used if desired to have the published test dataset remain on the node after test publication.


test-download
-------------

The ``esgtest_publish`` utility can test the unrestricted download of the test file from the default thredds root (assumed to be the same file system) with ``--test-download`` or ``-d`` option added to command line.
