

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Mapfile preparation &mdash; esg-publisher 3.7.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="esg-publisher 3.7.0 documentation" href="index.html"/>
        <link rel="next" title="Usage" href="usage.html"/>
        <link rel="prev" title="Configuration" href="configuration.html"/> 

  
  <script src="static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> esg-publisher
          

          
          </a>

          
            
            
              <div class="version">
                3.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="testpublication.html">Quick guide to test publication</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Mapfile preparation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#set-up-default-environment-for-scripts">Set up default environment for scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generate-your-mapfile-s-using-the-esgprep-utitlity">Generate your mapfile(s) using the esgprep utitlity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-usage-of-esgmapfile">Basic usage of esgmapfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-technical-note-to-the-mapfile">Adding a Technical Note to the mapfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-options-of-esgmapfile">Further options of esgmapfile</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ and known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Usage and Publication Tools</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">esg-publisher</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Mapfile preparation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="sources/mapfiles.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mapfile-preparation">
<span id="mapfiles"></span><h1>Mapfile preparation<a class="headerlink" href="#mapfile-preparation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="set-up-default-environment-for-scripts">
<h2>Set up default environment for scripts<a class="headerlink" href="#set-up-default-environment-for-scripts" title="Permalink to this headline">¶</a></h2>
<p>ESGF v2.5 or later</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ source /usr/local/conda/bin/activate esgf-pub
</pre></div>
</div>
<p>ESGF v2.4.x or earlier</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ source /etc/esg.env
</pre></div>
</div>
</div>
<div class="section" id="generate-your-mapfile-s-using-the-esgprep-utitlity">
<h2>Generate your mapfile(s) using the esgprep utitlity<a class="headerlink" href="#generate-your-mapfile-s-using-the-esgprep-utitlity" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This documentation refers to esgprep v2.8.x, which featured a significant command-line interface refactor.  For previous versions (v2.7.x) or earlier, instead of using the <code class="docutils literal notranslate"><span class="pre">esgmapfile</span></code> command, use <code class="docutils literal notranslate"><span class="pre">esgprep</span> <span class="pre">mapfile</span></code></p>
</div>
<div class="section" id="basic-usage-of-esgmapfile">
<h3>Basic usage of esgmapfile<a class="headerlink" href="#basic-usage-of-esgmapfile" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/ESGF/esgf-prepare">esgprep toolbox</a> is a standalone tool to generate mapfiles, fetch the project specific configuration files,
check the vocabulary, etc. It will be installed during the esg-publisher setup.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">The full documentation of esgprep toolbox can be found on github: <a class="reference external" href="http://esgf.github.io/esgf-prepare/">http://esgf.github.io/esgf-prepare/</a>.</p>
</div>
<p>The basic command to generate the mapfile(s):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ esgmapfile [optional: -i &lt;ini_directory&gt; --outdir &lt;output_mapfile&gt;] --project &lt;project_name&gt; &lt;target_path_for_data_files&gt;
</pre></div>
</div>
<p>This will recursively scan the <code class="docutils literal notranslate"><span class="pre">target_path_for_data_files</span></code> and build datasets. If datasets with multiple versions are found it will produce only the latest.
By default it will produce one mapfile per dataset using the syntax <code class="docutils literal notranslate"><span class="pre">{dataset_id}.{version}.map</span></code> as filename and the current working directory as output location.</p>
<p>Example: Generate a set of mapfiles</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ esgmapfile --project cmip5 /esg/data/cmip5/output1/MPI-M/MPI-ESM-P/historical/day/atmos/day --outdir /esg/mapfiles
</pre></div>
</div>
<p>This will produce two mapfiles, i.e.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls /esg/mapfiles

cmip5.output1.MPI-M.MPI-ESM-P.historical.day.atmos.day.r1i1p1.v20120315.map
cmip5.output1.MPI-M.MPI-ESM-P.historical.day.atmos.day.r2i1p1.v20120315.map

$ less /esg/mapfiles/cmip5.output1.MPI-M.MPI-ESM-P.historical.day.atmos.day.r1i1p1.v20120315.map

cmip5.output1.MPI-M.MPI-ESM-P.historical.day.atmos.day.r1i1p1#20120315 | /esg/data/cmip5/output1/MPI-M/MPI-ESM-P/historical/day/atmos/day/r1i1p1/v20120315/ta/ta_day_MPI-ESM-P_historical_r1i1p1_19910101-19911231.nc | 403684988 | mod_time=1329808188.000000 | checksum=b644aa3ac81de2ece6098409e1bcd62982c1dd6e9154a3d4ffb71639cba3e721 | checksum_type=SHA256
cmip5.output1.MPI-M.MPI-ESM-P.historical.day.atmos.day.r1i1p1#20120315 | /esg/data/cmip5/output1/MPI-M/MPI-ESM-P/historical/day/atmos/day/r1i1p1/v20120315/wap/wap_day_MPI-ESM-P_historical_r1i1p1_19790101-19791231.nc | 403685160 | mod_time=1329795098.000000 | checksum=9e5b8e0ecc676e4a484a1c1359ae8bf71aa06f639e88564d649be49bb9a101d3 | checksum_type=SHA256
cmip5.output1.MPI-M.MPI-ESM-P.historical.day.atmos.day.r1i1p1#20120315 | /esg/data/cmip5/output1/MPI-M/MPI-ESM-P/historical/day/atmos/day/r1i1p1/v20120315/tas/tas_day_MPI-ESM-P_historical_r1i1p1_18500101-18591231.nc | 269357732 | mod_time=1329500471.000000 | checksum=c2926960f90cce3f2884476fa07f5d6ac7d4e83918708259136039f6b904357b | checksum_type=SHA256
cmip5.output1.MPI-M.MPI-ESM-P.historical.day.atmos.day.r1i1p1#20120315 | /esg/data/cmip5/output1/MPI-M/MPI-ESM-P/historical/day/atmos/day/r1i1p1/v20120315/wap/wap_day_MPI-ESM-P_historical_r1i1p1_19660101-19661231.nc | 403685160 | mod_time=1329780069.000000 | checksum=e0408268c30bd7996ff8553d648bcb48e11f69c8d7428f236ef713d560582542 | checksum_type=SHA256
cmip5.output1.MPI-M.MPI-ESM-P.historical.day.atmos.day.r1i1p1#20120315 | /esg/data/cmip5/output1/MPI-M/MPI-ESM-P/historical/day/atmos/day/r1i1p1/v20120315/ua/ua_day_MPI-ESM-P_historical_r1i1p1_19930101-19931231.nc | 403684892 | mod_time=1329810439.000000 | checksum=eb448c6b42ab83ec31259b5e6f9d7cfd2bfbce54a2d335c477524173db80ce6c | checksum_type=SHA256
cmip5.output1.MPI-M.MPI-ESM-P.historical.day.atmos.day.r1i1p1#20120315 | /esg/data/cmip5/output1/MPI-M/MPI-ESM-P/historical/day/atmos/day/r1i1p1/v20120315/sfcWind/sfcWind_day_MPI-ESM-P_historical_r1i1p1_18900101-18991231.nc | 269357640 | mod_time=1329549793.000000 | checksum=de73970345c8175a49b3c4130dc393599817bf3186a8ed6237c742534ed6ffe4 | checksum_type=SHA256
</pre></div>
</div>
</div>
<div class="section" id="adding-a-technical-note-to-the-mapfile">
<span id="tech-note"></span><h3>Adding a Technical Note to the mapfile<a class="headerlink" href="#adding-a-technical-note-to-the-mapfile" title="Permalink to this headline">¶</a></h3>
<p>To add a Technical Note to the data (e.g. for obs4MIPs) please run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ esgmapfile --project &lt;project_name&gt; --tech-notes-url &lt;tech_notes_url&gt; --tech-notes-title &lt;tech_notes_title&gt; &lt;target_path_for_data_files&gt;
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ esgmapfile --project obs4MIPs --tech-notes-url http://esgf-test.dkrz.de/thredds/fileServer/tech_note.pdf --tech-notes-title &#39;obs4MIPs Tech Note&#39; /esg/data/obs4MIPs

$ less obs4MIPs_test.v20160811.map

obs4MIPs_test#20160811 | /esg/data/obs4MIPs/testfile1.nc | 50989760 | mod_time=1402486592.000000 | checksum=a5ddace30826a440207cdb0bf0f0ea9fd3f2c699a90aef5f71cbbd8f84c50a56 | checksum_type=SHA256 | dataset_tech_notes=http://esgf-test.dkrz.de/thredds/fileServer/tech_note.pdf | dataset_tech_notes_title=obs4MIPs Tech Note
obs4MIPs_test#20160811 | /esg/data/obs4MIPs/testfile2.nc | 2116695 | mod_time=1402486544.000000 | checksum=37c2e002d67c3408c43be373ced777ed85c78fbe31fee823840b1285f83b9870 | checksum_type=SHA256 | dataset_tech_notes=http://esgf-test.dkrz.de/thredds/fileServer/tech_note.pdf | dataset_tech_notes_title=obs4MIPs Tech Note
</pre></div>
</div>
</div>
<div class="section" id="further-options-of-esgmapfile">
<h3>Further options of esgmapfile<a class="headerlink" href="#further-options-of-esgmapfile" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>–mapfile &lt;{dataset_id}.{version}.map&gt;</dt>
<dd>Specifies template for the output mapfile(s) name. Substrings {dataset_id}, {version}, {job_id} or {date} (in YYYYDDMM) will be substituted where found. If {dataset_id} is not present in mapfile name, then all datasets will be written to a single mapfile.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>–all-versions</dt>
<dd>Generates mapfile(s) with all versions found in the directory recursively scanned.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>–version &lt;version_number&gt;</dt>
<dd>Generates mapfile(s) scanning datasets with the corresponding version number only. If directly specified in positional argument, use the version number from supplied directory.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>–latest-symlink</dt>
<dd>Generates mapfile(s) following latest symlinks only. This sets the {version} token to “latest” into the mapfile name but picked up the pointed version to build the dataset identifier.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>–outdir &lt;output_mapfile&gt;</dt>
<dd>Mapfile(s) output directory. A “mapfile_drs” can be defined per each project section in esg.&lt;project&gt;.ini files and joined to build a mapfiles tree.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>–max-threads &lt;4&gt;</dt>
<dd>Number of maximal threads to simultaneously process several files (useful if checksum calculation is enabled). Set to one seems sequential processing.</dd>
</dl>
</li>
</ul>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usage.html" class="btn btn-neutral float-right" title="Usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configuration.html" class="btn btn-neutral" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, ESGF Publication Working Team (PWT).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3.7.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="static/jquery.js"></script>
      <script type="text/javascript" src="static/underscore.js"></script>
      <script type="text/javascript" src="static/doctools.js"></script>
      <script type="text/javascript" src="static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>