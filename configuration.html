

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration &mdash; esg-publisher 3.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="esg-publisher 3.0.1 documentation" href="index.html"/>
        <link rel="next" title="Mapfile preparation" href="mapfiles.html"/>
        <link rel="prev" title="Installation" href="installation.html"/> 

  
  <script src="static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> esg-publisher
          

          
          </a>

          
            
            
              <div class="version">
                3.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prepare-the-configuration-files">Prepare the configuration files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-default-config-file-esg-ini">The default config file: esg.ini</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-project-specific-config-files-esg-project-ini">The project specific config files: esg.&lt;project&gt;.ini</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#prepare-user-and-permissions-for-publication">Prepare user and permissions for publication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#publish-to-an-index-node-at-another-side">Publish to an index node at another side</a></li>
<li class="toctree-l3"><a class="reference internal" href="#publish-to-your-own-index-node">Publish to your own index node</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-credentials">Generate credentials</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mapfiles.html">Mapfile preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">esg-publisher</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Configuration</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="sources/configuration.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration">
<span id="id1"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prepare-the-configuration-files">
<h2>Prepare the configuration files<a class="headerlink" href="#prepare-the-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>The ESGF publisher needs two sort of configuration files:</p>
<dl class="docutils">
<dt>esg.ini</dt>
<dd>This file is the primary means of configuring the default behavior of the publisher.</dd>
<dt>esg.&lt;project&gt;.ini</dt>
<dd>The project configuration files contain the project specific sections for publication of particular projects, e.g. <code class="docutils literal"><span class="pre">esg.cmip5.ini</span></code> for CMIP5,
<code class="docutils literal"><span class="pre">esg.cordex.ini</span></code> for CORDEX, etc.</dd>
</dl>
<p>A <code class="docutils literal"><span class="pre">esg.ini</span></code> template and several <code class="docutils literal"><span class="pre">esg.&lt;project&gt;.ini</span></code> files are available from the <a class="reference external" href="https://github.com/ESGF/config/tree/master/publisher-configs/ini">ESGF config repo</a> on GitHub.</p>
<p>The default location of all publisher related configuration files is <code class="docutils literal"><span class="pre">/esg/config/esgcet/</span></code>. The ESGF publisher will automatically read from the files in this directory.
Alternatively, you may specify the location of the ini files via <code class="docutils literal"><span class="pre">-i</span></code> option.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although it is recommended to generate one configuration file per project the publisher will also work for a single esg.ini that contains all necessary project sections.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">After any modification of the configuration files or the models table you need to update the postgreSQL database by running: <code class="docutils literal"><span class="pre">$</span> <span class="pre">esginitialize</span> <span class="pre">-c</span></code></p>
</div>
<div class="section" id="the-default-config-file-esg-ini">
<h3>The default config file: esg.ini<a class="headerlink" href="#the-default-config-file-esg-ini" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">esg.ini</span></code> contains all basic configs needed for the ESGF publisher, i.e. the <code class="docutils literal"><span class="pre">[DEFAULT]</span></code>, <code class="docutils literal"><span class="pre">[initialize]</span></code>, <code class="docutils literal"><span class="pre">[extract]</span></code>, <code class="docutils literal"><span class="pre">[srmls]</span></code> and <code class="docutils literal"><span class="pre">[hsi]</span></code>
sections. This file will be set up during the ESGF installation process.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Ensure the <code class="docutils literal"><span class="pre">hessian_service_url</span></code> contains the correct index node as this has been known to be overwritten.</p>
</div>
<ol class="arabic">
<li><p class="first">The <code class="docutils literal"><span class="pre">[DEFAULT]</span></code> section</p>
<blockquote>
<div><ul>
<li><p class="first">Section name and default configs</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="n">checksum</span> <span class="o">=</span> <span class="n">sha256sum</span> <span class="o">|</span> <span class="n">SHA256</span>
<span class="n">log_format</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">levelname</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="n">s</span> <span class="o">%</span><span class="p">(</span><span class="n">asctime</span><span class="p">)</span><span class="n">s</span> <span class="o">%</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="n">s</span>
<span class="n">log_level</span> <span class="o">=</span> <span class="n">INFO</span>
<span class="n">root_id</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">your_node</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Project options</p>
<blockquote>
<div><p>Ensure that the project you wish to publish is found in the <code class="docutils literal"><span class="pre">project_options</span></code>. Also make sure that it has it&#8217;s own project specific ini file,
<code class="docutils literal"><span class="pre">esg.&lt;project&gt;.ini</span></code>, e.g. <code class="docutils literal"><span class="pre">esg.cmip5.ini</span></code>.</p>
<p>Format of the project_options:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">project_options</span> <span class="o">=</span>
    <span class="o">&lt;</span><span class="n">project_name_1</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">next_integer_value_from_above_project</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">project_name_2</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">next_integer_value_from_above_project</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">project_options</span> <span class="o">=</span>
    <span class="n">cmip5</span>    <span class="o">|</span> <span class="n">CMIP5</span>    <span class="o">|</span> <span class="mi">1</span>
    <span class="n">cordex</span>   <span class="o">|</span> <span class="n">CORDEX</span>   <span class="o">|</span> <span class="mi">2</span>
    <span class="n">obs4MIPs</span> <span class="o">|</span> <span class="n">obs4MIPs</span> <span class="o">|</span> <span class="mi">3</span>
    <span class="n">test</span>     <span class="o">|</span> <span class="n">TEST</span>     <span class="o">|</span> <span class="mi">4</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">project_options</span></code> are updated automatically if you fetch the project ini files by running <code class="docutils literal"><span class="pre">$</span> <span class="pre">esgprep</span> <span class="pre">fetch-ini</span></code>.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Postgres configuration</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dburl</span> <span class="o">=</span> <span class="n">postgresql</span><span class="p">:</span><span class="o">//</span><span class="n">esgcet</span><span class="p">:</span><span class="o">&lt;</span><span class="n">esgcet_password</span><span class="o">&gt;</span><span class="nd">@localhost</span><span class="p">:</span><span class="mi">5432</span><span class="o">/</span><span class="n">esgcet</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Thredds configuration</p>
<blockquote>
<div><p>Ensure that the directory/mountpoint where you store the files for publication is set under <code class="docutils literal"><span class="pre">thredds_dataset_roots</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Dataset roots should never contain one another. If the data for a particular project is contained within a single directory even if
the node publishes just that project, it should be a subdirectory of the root, not included in the dataset_root directory.</p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>thredds_aggregation_services =
        OpenDAP | /thredds/dodsC/            | gridded
        LAS     | http://&lt;fqdn&gt;/las/getUI.do | LASat&lt;your_node&gt;
thredds_authentication_realm = THREDDS Data Server
thredds_catalog_basename = %(dataset_id)s.v%(version)s.xml
thredds_dataset_roots =
        esg_dataroot | /esg/data
        cmip5        | /data/cmip5
thredds_error_pattern = Catalog init
thredds_fatal_error_pattern = **Fatal
thredds_file_services =
        HTTPServer | /thredds/fileServer/          | HTTPServer    | fileservice
        GridFTP    | gsiftp://&lt;fqdn&gt;:2811/         | GRIDFTP       | fileservice
        OpenDAP    | /thredds/dodsC/               | OpenDAPServer | fileservice
        Globus     | globus:#DEFAULTENDPOINTNAME#/ | Globus        | fileservice
thredds_master_catalog_name = Earth System Grid catalog
thredds_max_catalogs_per_directory = 500
thredds_offline_services =
        SRM | srm://&lt;fqdn&gt;:6288/srm/v2/server?SFN=/archive.sample.gov | HRMatPCMDI
thredds_password = &lt;thredds_password&gt;
thredds_reinit_error_url = https://localhost:443/thredds/admin/content/logs/catalogInit.log
thredds_reinit_success_pattern = reinit ok
thredds_reinit_url = https://localhost:443/thredds/admin/debug?Catalogs/recheck
thredds_restrict_access = esg-user
thredds_root = /esg/content/thredds/esgcet
thredds_root_catalog_name = Earth System Root catalog
thredds_url = http://&lt;fqdn&gt;/thredds/catalog/esgcet
thredds_username = dnode_user
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended to have all <code class="docutils literal"><span class="pre">thredds_file_services</span></code> including <cite>HTTPServer</cite>, <cite>GridFTP</cite>, <cite>OpenDAP</cite> and <cite>Globus</cite> unless specific node configuration is needed.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Index node configuration</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">hessian_service_certfile</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">home</span><span class="p">)</span><span class="n">s</span><span class="o">/.</span><span class="n">globus</span><span class="o">/</span><span class="n">certificate</span><span class="o">-</span><span class="n">file</span>
<span class="n">hessian_service_debug</span> <span class="o">=</span> <span class="n">false</span>
<span class="n">hessian_service_keyfile</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">home</span><span class="p">)</span><span class="n">s</span><span class="o">/.</span><span class="n">globus</span><span class="o">/</span><span class="n">certificate</span><span class="o">-</span><span class="n">file</span>
<span class="n">hessian_service_polling_delay</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">hessian_service_polling_iterations</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">hessian_service_port</span> <span class="o">=</span> <span class="mi">443</span>
<span class="n">hessian_service_remote_metadata_url</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="o">/</span><span class="n">esgcet</span><span class="o">/</span><span class="n">remote</span><span class="o">/</span><span class="n">hessian</span><span class="o">/</span><span class="n">guest</span><span class="o">/</span><span class="n">remoteMetadataService</span>
<span class="n">hessian_service_url</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">index_fqdn</span><span class="o">&gt;/</span><span class="n">esg</span><span class="o">-</span><span class="n">search</span><span class="o">/</span><span class="n">remote</span><span class="o">/</span><span class="n">secure</span><span class="o">/</span><span class="n">client</span><span class="o">-</span><span class="n">cert</span><span class="o">/</span><span class="n">hessian</span><span class="o">/</span><span class="n">publishingService</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">[initialize]</span></code> section</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">initialize</span><span class="p">]</span>
<span class="n">initial_models_table</span> <span class="o">=</span> <span class="o">/</span><span class="n">esg</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">esgcet</span><span class="o">/</span><span class="n">esgcet_models_table</span><span class="o">.</span><span class="n">txt</span>
<span class="n">log_level</span> <span class="o">=</span> <span class="n">INFO</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">esgcet_models_table</span></code> is a separate file for the configuration of all models. The default location of this file is <code class="docutils literal"><span class="pre">/esg/config/esgcet/esgcet_models_table.txt</span></code>.</p>
<p>Format of the models table:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">project</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">model_1</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">model_url_1</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">model_description</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">project</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">model_2</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">model_url_2</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">model_description</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cmip5</span> <span class="o">|</span> <span class="n">MPI</span><span class="o">-</span><span class="n">ESM</span><span class="o">-</span><span class="n">P</span>  <span class="o">|</span> <span class="o">|</span> <span class="n">MPI</span><span class="o">-</span><span class="n">ESM</span><span class="o">-</span><span class="n">P</span><span class="p">,</span> <span class="n">Max</span> <span class="n">Planck</span> <span class="n">Institute</span> <span class="k">for</span> <span class="n">Meteorology</span> <span class="p">(</span><span class="n">MPI</span><span class="o">-</span><span class="n">M</span><span class="p">)</span>
<span class="n">cmip5</span> <span class="o">|</span> <span class="n">MPI</span><span class="o">-</span><span class="n">ESM</span><span class="o">-</span><span class="n">LR</span> <span class="o">|</span> <span class="o">|</span> <span class="n">MPI</span><span class="o">-</span><span class="n">ESM</span><span class="o">-</span><span class="n">LR</span><span class="p">,</span> <span class="n">Max</span> <span class="n">Planck</span> <span class="n">Institute</span> <span class="k">for</span> <span class="n">Meteorology</span> <span class="p">(</span><span class="n">MPI</span><span class="o">-</span><span class="n">M</span><span class="p">)</span>
<span class="n">cmip5</span> <span class="o">|</span> <span class="n">MPI</span><span class="o">-</span><span class="n">ESM</span><span class="o">-</span><span class="n">MR</span> <span class="o">|</span> <span class="o">|</span> <span class="n">MPI</span><span class="o">-</span><span class="n">ESM</span><span class="o">-</span><span class="n">MR</span><span class="p">,</span> <span class="n">Max</span> <span class="n">Planck</span> <span class="n">Institute</span> <span class="k">for</span> <span class="n">Meteorology</span> <span class="p">(</span><span class="n">MPI</span><span class="o">-</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are defining a new project but using an existing model name, you need to add a new entry to the table file for your new pairing as well.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After modifying the models table please run <code class="docutils literal"><span class="pre">$</span> <span class="pre">esginitialize</span> <span class="pre">-c</span></code>  to update the postgres database.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Other sections, e.g. for scanning the files and the offline services</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">extract</span><span class="p">]</span>
<span class="n">log_level</span> <span class="o">=</span> <span class="n">INFO</span>
<span class="n">validate_standard_names</span> <span class="o">=</span> <span class="kc">True</span>

<span class="p">[</span><span class="n">srmls</span><span class="p">]</span>
<span class="n">offline_lister_executable</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">home</span><span class="p">)</span><span class="n">s</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">Esgcet</span><span class="o">/</span><span class="n">esgcet</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">srmls</span><span class="o">.</span><span class="n">py</span>
<span class="n">srm_archive</span> <span class="o">=</span> <span class="o">/</span><span class="n">garchive</span><span class="o">.</span><span class="n">nersc</span><span class="o">.</span><span class="n">gov</span>
<span class="n">srm_server</span> <span class="o">=</span> <span class="n">srm</span><span class="p">:</span><span class="o">//</span><span class="n">somehost</span><span class="o">.</span><span class="n">llnl</span><span class="o">.</span><span class="n">gov</span><span class="p">:</span><span class="mi">6288</span><span class="o">/</span><span class="n">srm</span><span class="o">/</span><span class="n">v2</span><span class="o">/</span><span class="n">server</span>
<span class="n">srmls</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">esg</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">srm</span><span class="o">-</span><span class="n">ls</span>

<span class="p">[</span><span class="n">hsi</span><span class="p">]</span>
<span class="n">hsi</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">hsi</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="the-project-specific-config-files-esg-project-ini">
<h3>The project specific config files: esg.&lt;project&gt;.ini<a class="headerlink" href="#the-project-specific-config-files-esg-project-ini" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Set the section name</p>
<blockquote>
<div><p>Each project specific configuration file starts with a section name following the <code class="docutils literal"><span class="pre">[project:&lt;project_name&gt;]</span></code> syntax.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Please note: The &lt;project_name&gt; is case sensitive and needs to match the file name and the project name you specify with <code class="docutils literal"><span class="pre">--project</span></code>,
e.g. <code class="docutils literal"><span class="pre">esg.cmip5.ini</span></code>, <code class="docutils literal"><span class="pre">[project:cmip5]</span></code>, <code class="docutils literal"><span class="pre">--project</span> <span class="pre">cmip5</span></code>.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Set the <code class="docutils literal"><span class="pre">categories</span></code> to be used for the project</p>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">categories</span></code> define the facet fields. All facets listed as <code class="docutils literal"><span class="pre">enum</span></code> will be checked against the <a class="reference internal" href="#facet-options"><span class="std std-ref">facet_options, facet_map or
facet_pattern</span></a>. Facets that are listed as <code class="docutils literal"><span class="pre">string</span></code> will not be checked unless they are part of the <code class="docutils literal"><span class="pre">directory_format</span></code>.</p>
<p>Format of the categories:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">|</span> <span class="n">category_type</span> <span class="o">|</span> <span class="n">is_mandatory</span> <span class="o">|</span> <span class="n">is_thredds_property</span> <span class="o">|</span> <span class="n">display_order</span>
</pre></div>
</div>
<p>If the value for <code class="docutils literal"><span class="pre">is_thredds_property</span></code> is set to <code class="docutils literal"><span class="pre">true</span></code> the facet will appear in the Thredds Catalog and in the Index.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">categories</span> <span class="o">=</span>
    <span class="n">project</span>        <span class="o">|</span> <span class="n">enum</span>   <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="mi">0</span>
    <span class="n">product</span>        <span class="o">|</span> <span class="n">enum</span>   <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="mi">1</span>
    <span class="n">institute</span>      <span class="o">|</span> <span class="n">string</span> <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="mi">2</span>
    <span class="n">model</span>          <span class="o">|</span> <span class="n">enum</span>   <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="mi">3</span>
    <span class="n">experiment</span>     <span class="o">|</span> <span class="n">enum</span>   <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="mi">4</span>
    <span class="n">time_frequency</span> <span class="o">|</span> <span class="n">enum</span>   <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="mi">5</span>
    <span class="n">realm</span>          <span class="o">|</span> <span class="n">enum</span>   <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="mi">6</span>
    <span class="n">cmor_table</span>     <span class="o">|</span> <span class="n">enum</span>   <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="mi">7</span>
    <span class="n">ensemble</span>       <span class="o">|</span> <span class="n">string</span> <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="n">true</span>  <span class="o">|</span> <span class="mi">8</span>
    <span class="n">description</span>    <span class="o">|</span> <span class="n">text</span>   <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="mi">99</span>
</pre></div>
</div>
<p>You can also set a default value for particular categories, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">category_defaults</span> <span class="o">=</span>
    <span class="n">project</span> <span class="o">|</span> <span class="n">cmip5</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">directory_format</span></code></p>
<blockquote>
<div><p>Ensure that the <code class="docutils literal"><span class="pre">directory_format</span></code> is spelled out for the project, check carefully for typos. Data files must be found in the rightmost set of subdirectories specified,
the not-project-specific root part in front of the project-specific DRS elements can be specified as <code class="docutils literal"><span class="pre">%(root)</span></code>, all project related elements must be defined separately,
following the <code class="docutils literal"><span class="pre">%(name)s</span></code> syntax, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">directory_format</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">/%</span><span class="p">(</span><span class="n">project</span><span class="p">)</span><span class="n">s</span><span class="o">/%</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="n">s</span><span class="o">/%</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span><span class="n">s</span><span class="o">/%</span><span class="p">(</span><span class="n">realm</span><span class="p">)</span><span class="n">s</span>
<span class="ow">or</span>
<span class="n">directory_format</span> <span class="o">=</span> <span class="o">/</span><span class="n">some_mountpoint</span><span class="o">/</span><span class="n">data</span><span class="o">/%</span><span class="p">(</span><span class="n">project</span><span class="p">)</span><span class="n">s</span><span class="o">/%</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="n">s</span><span class="o">/%</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span><span class="n">s</span><span class="o">/%</span><span class="p">(</span><span class="n">realm</span><span class="p">)</span><span class="n">s</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">some_mountpoint</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">cmip5</span><span class="o">/</span><span class="n">CESM</span><span class="o">/</span><span class="n">historical</span><span class="o">/</span><span class="n">atmos</span><span class="o">/</span><span class="n">blah</span><span class="o">.</span><span class="n">nc</span>   <span class="o">-</span> <span class="n">valid</span>
<span class="o">/</span><span class="n">some_mountpoint</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">cmip5</span><span class="o">/</span><span class="n">CESM</span><span class="o">/</span><span class="n">historical</span><span class="o">/</span><span class="n">atmos</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="n">blah</span><span class="o">.</span><span class="n">nc</span> <span class="o">-</span> <span class="ow">not</span> <span class="n">valid</span>
<span class="o">/</span><span class="n">some_mountpoint</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">cmip5</span><span class="o">/</span><span class="n">CESM</span><span class="o">/</span><span class="n">historical</span><span class="o">/</span><span class="n">blah</span><span class="o">.</span><span class="n">nc</span>         <span class="o">-</span> <span class="ow">not</span> <span class="n">valid</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal"><span class="pre">/some_mountpoint/data</span></code> must be included in the <code class="docutils literal"><span class="pre">thredds_dataset_roots</span></code> entry in the <code class="docutils literal"><span class="pre">[DEFAULT]</span></code> section of esg.ini.</p>
</div></blockquote>
</li>
<li><p class="first">Ensure that you have a <code class="docutils literal"><span class="pre">dataset_id</span></code> and optional a <code class="docutils literal"><span class="pre">dataset_name_format</span></code></p>
<blockquote>
<div><p>The <code class="docutils literal"><span class="pre">dataset_id</span></code> is project specific and may mirror the directory structure to a point.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dataset_id</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">project</span><span class="p">)</span><span class="n">s</span><span class="o">.%</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="n">s</span><span class="o">.%</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span><span class="n">s</span><span class="o">.%</span><span class="p">(</span><span class="n">realm</span><span class="p">)</span><span class="n">s</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The facets used for the <code class="docutils literal"><span class="pre">dataset_id</span></code> must be a subset of those used in the <code class="docutils literal"><span class="pre">directory_format</span></code>. In other words, the facet names
for the <code class="docutils literal"><span class="pre">dataset_id</span></code> must appear as variables within the <code class="docutils literal"><span class="pre">directory_format</span></code> using the same corresponding names with the <code class="docutils literal"><span class="pre">%(name)s</span></code> syntax or
must be derived from some other category using a <code class="docutils literal"><span class="pre">category_map</span></code> entry in <code class="docutils literal"><span class="pre">esg.&lt;project&gt;.ini</span></code>. An error or undefined behavior, such as the sudden absence
of that facet value from the <code class="docutils literal"><span class="pre">dataset_id</span></code>, might result otherwise.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">dataset_name_format</span></code> is a description of the dataset and will appear in the Thredds catalogs and in the Index.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dataset_name_format</span> <span class="o">=</span> <span class="n">project</span><span class="o">=%</span><span class="p">(</span><span class="n">project_description</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="n">model</span><span class="o">=%</span><span class="p">(</span><span class="n">model_description</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=%</span><span class="p">(</span><span class="n">experiment_description</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="n">time_frequency</span><span class="o">=%</span><span class="p">(</span><span class="n">time_frequency</span><span class="p">)</span><span class="n">s</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li id="facet-options"><p class="first">Generate a <code class="docutils literal"><span class="pre">&lt;facet&gt;_options</span></code> list, a <code class="docutils literal"><span class="pre">&lt;facet&gt;_map</span></code> or a <code class="docutils literal"><span class="pre">&lt;facet&gt;_pattern</span></code> for each facet</p>
<blockquote>
<div><p>The metadata for each facet that is part of the <code class="docutils literal"><span class="pre">directory_format</span></code> (except for <cite>version</cite> and <cite>variable</cite>) is checked against the values in <cite>facet_options</cite>, <cite>facet_map</cite> or <cite>facet_pattern</cite>.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">&lt;facet&gt;_options</span></code></p>
<blockquote>
<div><p>This is a simple list that contains all possible values for a facet, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">model_options</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">-</span><span class="n">ESM</span><span class="o">-</span><span class="n">LR</span><span class="p">,</span> <span class="n">MPI</span><span class="o">-</span><span class="n">ESM</span><span class="o">-</span><span class="n">MR</span><span class="p">,</span> <span class="n">MPI</span><span class="o">-</span><span class="n">ESM</span><span class="o">-</span><span class="n">P</span>
<span class="n">time_frequency_options</span> <span class="o">=</span> <span class="mi">3</span><span class="n">hr</span><span class="p">,</span> <span class="mi">6</span><span class="n">hr</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">monClim</span><span class="p">,</span> <span class="n">subhr</span><span class="p">,</span> <span class="n">yr</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The option list for the experiments does not follow the above syntax. Each experiment has the format: <code class="docutils literal"><span class="pre">&lt;project&gt;</span> <span class="pre">|</span> <span class="pre">&lt;experiment&gt;</span> <span class="pre">|</span> <span class="pre">&lt;experiment_description&gt;</span></code></p>
<p>Example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">experiment_options</span> <span class="o">=</span>
    <span class="n">cmip5</span> <span class="o">|</span> <span class="mi">1</span><span class="n">pctCO2</span>     <span class="o">|</span> <span class="mi">1</span> <span class="n">percent</span> <span class="n">per</span> <span class="n">year</span> <span class="n">CO2</span>
    <span class="n">cmip5</span> <span class="o">|</span> <span class="n">abrupt4xCO2</span> <span class="o">|</span> <span class="n">Abrupt</span> <span class="mi">4</span><span class="n">xCO2</span>
    <span class="n">cmip5</span> <span class="o">|</span> <span class="n">amip</span>        <span class="o">|</span> <span class="n">AMIP</span>
    <span class="n">cmip5</span> <span class="o">|</span> <span class="n">amip4K</span>      <span class="o">|</span> <span class="n">AMIP</span> <span class="n">plus</span> <span class="mi">4</span><span class="n">K</span> <span class="n">anomaly</span>
    <span class="n">cmip5</span> <span class="o">|</span> <span class="n">amip4xCO2</span>   <span class="o">|</span> <span class="mi">4</span><span class="n">xCO2</span> <span class="n">AMIP</span>
    <span class="n">cmip5</span> <span class="o">|</span> <span class="n">amipFuture</span>  <span class="o">|</span> <span class="n">AMIP</span> <span class="n">plus</span> <span class="n">patterned</span> <span class="n">anomaly</span>
    <span class="n">cmip5</span> <span class="o">|</span> <span class="n">aqua4K</span>      <span class="o">|</span> <span class="n">Aqua</span> <span class="n">planet</span> <span class="n">plus</span> <span class="mi">4</span><span class="n">K</span> <span class="n">anomaly</span>
    <span class="n">cmip5</span> <span class="o">|</span> <span class="n">aqua4xCO2</span>   <span class="o">|</span> <span class="mi">4</span><span class="n">xCO2</span> <span class="n">aqua</span> <span class="n">planet</span>
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&lt;facet&gt;_map</span></code></p>
<blockquote>
<div><p>Using a <code class="docutils literal"><span class="pre">&lt;facet&gt;_map</span></code> is recommended if the facet is not part of the <code class="docutils literal"><span class="pre">directory_structure</span></code> and needs to be mapped to another value, e.g. for CORDEX:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rcm_name_map</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">rcm_model</span> <span class="p">:</span> <span class="n">rcm_name</span><span class="p">)</span>
    <span class="n">cordex</span> <span class="o">|</span> <span class="n">AWI</span><span class="o">-</span><span class="n">HIRHAM5</span>      <span class="o">|</span> <span class="n">HIRHAM5</span>
    <span class="n">cordex</span> <span class="o">|</span> <span class="n">GERICS</span><span class="o">-</span><span class="n">REMO2009</span>  <span class="o">|</span> <span class="n">REMO2009</span>
    <span class="n">cordex</span> <span class="o">|</span> <span class="n">KNMI</span><span class="o">-</span><span class="n">RACMO22E</span>    <span class="o">|</span> <span class="n">RACMO22E</span>
    <span class="n">cordex</span> <span class="o">|</span> <span class="n">MPI</span><span class="o">-</span><span class="n">CSC</span><span class="o">-</span><span class="n">REMO2009</span> <span class="o">|</span> <span class="n">REMO2009</span>
    <span class="n">cordex</span> <span class="o">|</span> <span class="n">UCLM</span><span class="o">-</span><span class="n">PROMES</span>      <span class="o">|</span> <span class="n">PROMES</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All &lt;facet&gt;_maps needs to be listed in the project ini file, e.g. <code class="docutils literal"><span class="pre">maps</span> <span class="pre">=</span> <span class="pre">rcm_name_map,</span> <span class="pre">las_time_delta_map</span></code>.</p>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&lt;facet&gt;_pattern</span></code></p>
<blockquote>
<div><p>A pattern should be used for facets that follow a known syntax, e.g. the ensemble facet:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ensemble_pattern</span> <span class="o">=</span> <span class="n">r</span><span class="o">%</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span><span class="n">si</span><span class="o">%</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span><span class="n">sp</span><span class="o">%</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span><span class="n">s</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The &lt;facet&gt;_pattern currently supports <code class="docutils literal"><span class="pre">%(digit)s</span></code> and <code class="docutils literal"><span class="pre">%(string)s</span></code>.</p>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Project Handler</p>
<blockquote>
<div><p>You can either use the publisher&#8217;s default handler, a pre-installed project handler or generate a custom handler.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The setup and configuration of a custom handler needs expert knowledge. For most projects the default handler will be sufficient.
The handlers for major projects like CMIP5 are pre-installed and for some minor projects you can find
<a class="reference external" href="https://github.com/ESGF/config/tree/master/publisher-configs/handlers">customized handlers</a> on github.</p>
</div>
<p>To use the default handler please add the following to your project configuration file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">project_handler_name</span> <span class="o">=</span> <span class="n">basic_builtin</span>
</pre></div>
</div>
<p>For the pre-installed project handler for CMIP5 add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">handler</span> <span class="o">=</span> <span class="n">esgcet</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ipcc5_handler</span><span class="p">:</span><span class="n">IPCC5Handler</span>
</pre></div>
</div>
<p>For creating a new customized handler you can run the following command that will generate the basic package:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ esgsetup --handler
</pre></div>
</div>
<p>Now you can customize the handler by editing the <code class="docutils literal"><span class="pre">project_handler.py</span></code> file and install the handler package with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd &lt;handler_name&gt;
$ python setup.py install
</pre></div>
</div>
<p>In your <code class="docutils literal"><span class="pre">esg.&lt;project&gt;.ini</span></code> file simply add whatever you have specified for the <code class="docutils literal"><span class="pre">project_handler_name</span></code> during the setup.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">project_handler_name</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">project_handler_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">thredds_exclude_variables</span></code> and <code class="docutils literal"><span class="pre">variable_per_file</span></code>.</p>
<blockquote>
<div><p>As mentioned above it is not needed to create a <code class="docutils literal"><span class="pre">variable_options</span></code> list. Instead we need to add a <code class="docutils literal"><span class="pre">thredds_exclude_variables</span></code> list that lists all
variables that might be part of the file content but are not the <cite>target</cite> variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">thredds_exclude_variables</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_bnds</span><span class="p">,</span> <span class="n">alev1</span><span class="p">,</span> <span class="n">alevel</span><span class="p">,</span> <span class="n">alevhalf</span><span class="p">,</span> <span class="n">alt40</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">variable_per_file</span></code> should be always set to <code class="docutils literal"><span class="pre">true</span></code>. If this is set to false no aggregations will be generated and all variables that are part of the dataset are wrongly assigned to every file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">variable_per_file</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If a excludes variable is missing in the <code class="docutils literal"><span class="pre">thredds_exclude_variables</span></code> and <code class="docutils literal"><span class="pre">variable_per_file</span></code> is set to true this might result in publishing the same file multiple times to Thredds.</p>
</div>
<p>If a variable can be <cite>taget</cite> variable <strong>and</strong> <cite>exclude</cite> variable it must be listed in the <code class="docutils literal"><span class="pre">variable_locate</span></code>.
The <code class="docutils literal"><span class="pre">variable_locate</span></code> is a list of variable and begin-of-filename pairs, following the syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">variable_locate</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">var1</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">begin_of_filename1</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">var2</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">begin_of_filename2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">variable_locate</span> <span class="o">=</span> <span class="n">ps</span><span class="p">,</span><span class="n">ps_</span> <span class="o">|</span> <span class="n">basin</span><span class="p">,</span><span class="n">basin_</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Enable and disable the LAS access</p>
<blockquote>
<div><p><a class="reference external" href="http://www.ferret.noaa.gov/LAS/home">The Live Access Server</a> (LAS) is part of the ESGF Installation and can be used to visualize the data.</p>
<p>If LAS is enabled the publisher will generate and publish a LAS-link for each dataset and aggregation.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># disable LAS</span>
<span class="n">las_configure</span> <span class="o">=</span> <span class="n">false</span>

<span class="c1"># enable LAS</span>
<span class="n">las_configure</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>For LAS you also need a <code class="docutils literal"><span class="pre">las_time_delta_map</span></code>, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">las_time_delta_map</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">time_frequency</span> <span class="p">:</span> <span class="n">las_time_delta</span><span class="p">)</span>
    <span class="n">yr</span>      <span class="o">|</span> <span class="mi">1</span> <span class="n">year</span>
    <span class="n">mon</span>     <span class="o">|</span> <span class="mi">1</span> <span class="n">month</span>
    <span class="n">day</span>     <span class="o">|</span> <span class="mi">1</span> <span class="n">day</span>
    <span class="mi">6</span><span class="n">hr</span>     <span class="o">|</span> <span class="mi">6</span> <span class="n">hours</span>
    <span class="mi">3</span><span class="n">hr</span>     <span class="o">|</span> <span class="mi">3</span> <span class="n">hours</span>
    <span class="n">subhr</span>   <span class="o">|</span> <span class="mi">1</span> <span class="n">minute</span>
    <span class="n">monClim</span> <span class="o">|</span> <span class="mi">1</span> <span class="n">month</span>
    <span class="n">fx</span>      <span class="o">|</span> <span class="n">fixed</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="section" id="prepare-user-and-permissions-for-publication">
<h2>Prepare user and permissions for publication<a class="headerlink" href="#prepare-user-and-permissions-for-publication" title="Permalink to this headline">¶</a></h2>
<div class="section" id="publish-to-an-index-node-at-another-side">
<h3>Publish to an index node at another side<a class="headerlink" href="#publish-to-an-index-node-at-another-side" title="Permalink to this headline">¶</a></h3>
<p>Please coordinate with that site&#8217;s node administrator.</p>
</div>
<div class="section" id="publish-to-your-own-index-node">
<h3>Publish to your own index node<a class="headerlink" href="#publish-to-your-own-index-node" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Verify publishing permissions: <code class="docutils literal"><span class="pre">/esg/config/esgf_policies_local.xml</span></code></p>
<blockquote>
<div><p>Specifications for datasets are given by regular expression. This could include a data_node or a project, institution, model, etc.
If you want to publish within a specified collection, ensure that an entry exists for that with a specified ESGF group, publisher role,
and Write action.</p>
<p>Example for publication of CMIP5 data only:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">policy</span> <span class="na">resource</span><span class="o">=</span><span class="s">&quot;.*cmip5.*&quot;</span> <span class="na">attribute_type</span><span class="o">=</span><span class="s">&quot;cmip5_publisher&quot;</span> <span class="na">attribute_value</span><span class="o">=</span><span class="s">&quot;publisher&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;Write&quot;</span><span class="p">/&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Example for publication of all projects from a particular ESGF node:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">policy</span> <span class="na">resource</span><span class="o">=</span><span class="s">&quot;.*esgf-test.dkrz.de.*&quot;</span> <span class="na">attribute_type</span><span class="o">=</span><span class="s">&quot;cmip5_publisher&quot;</span> <span class="na">attribute_value</span><span class="o">=</span><span class="s">&quot;publisher&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;Write&quot;</span><span class="p">/&gt;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
<li><p class="first">Group, role and permission in the Postgres database:</p>
<blockquote>
<div><p>For publication you need to create an ESGF account and add the appropriate role and group to that user. Therefore you have to modify the postgres database:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span># login to the escet database
$ psql -U dbsuper esgcet

# add a new group named cmip5_publisher
esgcet=# INSERT INTO esgf_security.group VALUES(3, &#39;cmip5_publisher&#39;, &#39;CMIP5 Publisher&#39;, true, true);

# update permission table
esgcet=# INSERT INTO esgf_security.permission VALUES(2, 3, 4, true);
</pre></div>
</div>
<p>For the example above the tables in esgcet should look like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">esgcet</span><span class="o">=</span><span class="c1"># SELECT * FROM esgf_security.user;</span>

<span class="nb">id</span> <span class="o">|</span> <span class="n">firstname</span> <span class="o">|</span> <span class="n">middlename</span> <span class="o">|</span> <span class="n">lastname</span> <span class="o">|</span>     <span class="n">email</span>     <span class="o">|</span>  <span class="n">username</span>    <span class="o">|</span> <span class="o">...</span>
<span class="o">---+-----------+------------+----------+---------------+--------------+-----</span>
<span class="mi">2</span>  <span class="o">|</span> <span class="n">Publish</span>   <span class="o">|</span>            <span class="o">|</span> <span class="n">User</span>     <span class="o">|</span> <span class="n">email</span><span class="nd">@address</span> <span class="o">|</span> <span class="n">publish_user</span> <span class="o">|</span> <span class="o">...</span>

<span class="n">esgcet</span><span class="o">=</span><span class="c1"># SELECT * FROM esgf_security.group;</span>

    <span class="nb">id</span> <span class="o">|</span> <span class="n">name</span>            <span class="o">|</span> <span class="n">description</span>     <span class="o">|</span> <span class="n">visible</span> <span class="o">|</span> <span class="n">automatic_approval</span>
<span class="o">----+-----------------+-----------------+---------+--------------------</span>
    <span class="mi">3</span>  <span class="o">|</span> <span class="n">cmip5_publisher</span> <span class="o">|</span> <span class="n">CMIP5</span> <span class="n">Publisher</span> <span class="o">|</span> <span class="n">t</span>       <span class="o">|</span> <span class="n">t</span>

<span class="n">esgcet</span><span class="o">=</span><span class="c1"># SELECT * FROM esgf_security.role;</span>

    <span class="nb">id</span> <span class="o">|</span> <span class="n">name</span>      <span class="o">|</span> <span class="n">description</span>
<span class="o">----+-----------+----------------</span>
    <span class="mi">4</span>  <span class="o">|</span> <span class="n">publisher</span> <span class="o">|</span> <span class="n">Data</span> <span class="n">Publisher</span>

<span class="n">esgcet</span><span class="o">=</span><span class="c1"># SELECT * FROM esgf_security.permission;</span>

    <span class="n">user_id</span> <span class="o">|</span> <span class="n">group_id</span> <span class="o">|</span> <span class="n">role_id</span> <span class="o">|</span> <span class="n">approved</span>
<span class="o">---------+----------+---------+----------</span>
    <span class="mi">2</span>       <span class="o">|</span> <span class="mi">3</span>        <span class="o">|</span> <span class="mi">4</span>       <span class="o">|</span> <span class="n">t</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Ensure that the ESGF group has an entry in the <code class="docutils literal"><span class="pre">/esg/config/esgf_ats_static.xml</span></code> file for the attribute service for that group, e.g.:</p>
<blockquote>
<div><div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">attribute</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;cmip5_publisher&quot;</span>
    <span class="na">attributeService</span><span class="o">=</span><span class="s">&quot;https://&lt;fqdn&gt;/esgf-idp/saml/soap/secure/attributeService.htm&quot;</span>
    <span class="na">description</span><span class="o">=</span><span class="s">&quot;Publisher group for CMIP5 data&quot;</span>
    <span class="na">registrationService</span><span class="o">=</span><span class="s">&quot;https://&lt;fqdn&gt;/esgf-idp/secure/registrationService.htm&quot;</span><span class="p">/&gt;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="generate-credentials">
<span id="myproxy-logon"></span><h3>Generate credentials<a class="headerlink" href="#generate-credentials" title="Permalink to this headline">¶</a></h3>
<p>For publication to an index node you need to have a valid globus certificate for an user with <cite>Write</cite> permissions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ mkdir $HOME/.globus   # if not already present
$ myproxy-logon [ -b ] -s &lt;openid_server&gt; -l &lt;esgf_username&gt; -p 7512 -t 72 -o $HOME/.globus/certificate-file
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The certificate is valid for 72 hours when specified by <code class="docutils literal"><span class="pre">-t</span></code>. If you are publishing for the first time, you will need to use <code class="docutils literal"><span class="pre">-b</span></code> to bootstrap it&#8217;s trustroots with the server.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Please get the <code class="docutils literal"><span class="pre">openid_server</span></code> and <code class="docutils literal"><span class="pre">esgf_username</span></code> from your ESGF OpenID, e.g.</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">openid</span><span class="p">:</span>        <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pcmdi</span><span class="o">.</span><span class="n">llnl</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span><span class="n">esgf</span><span class="o">-</span><span class="n">idp</span><span class="o">/</span><span class="n">openid</span><span class="o">/</span><span class="n">publish_user</span>
<span class="n">openid_server</span><span class="p">:</span> <span class="n">pcmdi</span><span class="o">.</span><span class="n">llnl</span><span class="o">.</span><span class="n">gov</span>
<span class="n">esgf_username</span><span class="p">:</span> <span class="n">publish_user</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mapfiles.html" class="btn btn-neutral float-right" title="Mapfile preparation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, ESGF Publication Working Team (PWT).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="static/jquery.js"></script>
      <script type="text/javascript" src="static/underscore.js"></script>
      <script type="text/javascript" src="static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>